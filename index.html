<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LittleBrett Platformer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      overflow: hidden;
    }
    canvas {
      display: block;
      background: #000;
    }
    .controls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      z-index: 10;
    }
    .controls img {
      width: 60px;
      height: 60px;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div class="controls">
    <img src="btn_left.png" id="btnLeft" />
    <img src="btn_jump.png" id="btnJump" />
    <img src="btn_right.png" id="btnRight" />
  </div>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const gravity = 1;

    const images = {};
    const imageNames = [
      'bg', 'platform_green', 'coin', 'btc', 'eth',
      'brett_idle', 'brett_walk1', 'brett_jump', 'brett_fall', 'brett_happy', 'brett_down', 'btn_start'
    ];

    let loadedImages = 0;

    imageNames.forEach(name => {
      const img = new Image();
      img.src = `${name}.png`;
      img.onload = () => {
        loadedImages++;
        if (loadedImages === imageNames.length) init();
      };
      images[name] = img;
    });

    let player, platforms, coins, scrollX = 0, gameStarted = false, gameOver = false, gameWin = false;

    class Player {
      constructor() {
        this.x = 100;
        this.y = canvas.height - 200;
        this.vx = 0;
        this.vy = 0;
        this.width = 80;
        this.height = 80;
        this.onGround = false;
      }
      draw() {
        let img = images.brett_idle;
        if (this.vy < 0) img = images.brett_jump;
        else if (this.vy > 0) img = images.brett_fall;
        else if (this.vx !== 0) img = images.brett_walk1;
        ctx.drawImage(img, this.x - scrollX, this.y, this.width, this.height);
      }
      update() {
        this.vy += gravity;
        this.x += this.vx;
        this.y += this.vy;

        this.onGround = false;
        for (let plat of platforms) {
          if (
            this.y + this.height <= plat.y &&
            this.y + this.height + this.vy >= plat.y &&
            this.x + this.width > plat.x &&
            this.x < plat.x + plat.width
          ) {
            this.vy = 0;
            this.y = plat.y - this.height;
            this.onGround = true;
          }
        }

        coins = coins.filter(coin => {
          const caught =
            this.x < coin.x + coin.size &&
            this.x + this.width > coin.x &&
            this.y < coin.y + coin.size &&
            this.y + this.height > coin.y;
          return !caught;
        });

        scrollX = this.x - 100;

        if (this.y > canvas.height) {
          gameOver = true;
        }
        if (this.x > platforms[platforms.length - 1].x + 100) {
          gameWin = true;
        }
      }
    }

    class Platform {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.width = 120;
        this.height = 20;
      }
      draw() {
        ctx.drawImage(images.platform_green, this.x - scrollX, this.y);
      }
    }

    class Coin {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.size = 32;
        this.type = type;
      }
      draw() {
        ctx.drawImage(images[this.type], this.x - scrollX, this.y, this.size, this.size);
      }
    }

    function init() {
      player = new Player();
      platforms = [];
      coins = [];

      for (let i = 0; i < 50; i++) {
        const x = i * 180;
        const y = canvas.height - 100 - Math.random() * 200;
        platforms.push(new Platform(x, y));

        const coinType = i % 3 === 0 ? 'btc' : i % 3 === 1 ? 'eth' : 'coin';
        coins.push(new Coin(x + 40, y - 40, coinType));
      }

      animate();
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);

      for (let plat of platforms) plat.draw();
      for (let coin of coins) coin.draw();

      if (!gameStarted) {
        ctx.drawImage(images.btn_start, canvas.width / 2 - 100, canvas.height / 2 - 100, 200, 100);
        requestAnimationFrame(animate);
        return;
      }

      player.update();
      player.draw();

      if (gameOver) {
        ctx.drawImage(images.brett_down, canvas.width / 2 - 100, canvas.height / 2 - 100);
        return;
      }

      if (gameWin) {
        ctx.drawImage(images.brett_happy, canvas.width / 2 - 100, canvas.height / 2 - 100);
        return;
      }

      requestAnimationFrame(animate);
    }

    window.addEventListener('keydown', e => {
      if (!gameStarted) {
        gameStarted = true;
        animate();
      }
      if (e.key === 'ArrowRight') player.vx = 5;
      if (e.key === 'ArrowLeft') player.vx = -5;
      if (e.key === ' ' && player.onGround) player.vy = -20;
    });

    window.addEventListener('keyup', e => {
      if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') player.vx = 0;
    });

    // MÃ³viles
    document.getElementById('btnLeft').addEventListener('touchstart', () => player.vx = -5);
    document.getElementById('btnRight').addEventListener('touchstart', () => player.vx = 5);
    document.getElementById('btnJump').addEventListener('touchstart', () => {
      if (player.onGround) player.vy = -20;
    });
    document.getElementById('btnLeft').addEventListener('touchend', () => player.vx = 0);
    document.getElementById('btnRight').addEventListener('touchend', () => player.vx = 0);
  </script>
</body>
</html>
