<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LittleBrett Platformer</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
      background: url('bg.png') no-repeat center center;
      background-size: cover;
    }
    #startButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <img id="startButton" src="btn_start.png" onclick="startGame()" />
  <canvas id="gameCanvas" width="1280" height="720"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let images = {};
    const keys = {};
    let gameStarted = false;

    const player = {
      x: 100,
      y: 0,
      width: 64,
      height: 64,
      vx: 0,
      vy: 0,
      gravity: 0.8,
      jumpPower: -15,
      grounded: false
    };

    let platforms = [];
    const coins = [];
    const totalPlatforms = 50;
    const platformSpacing = 200;
    let gameEnded = false;

    function loadImages(paths, callback) {
      let loaded = 0;
      const keys = Object.keys(paths);
      keys.forEach(key => {
        const img = new Image();
        img.src = paths[key];
        img.onload = () => {
          images[key] = img;
          loaded++;
          if (loaded === keys.length) callback();
        };
      });
    }

    function startGame() {
      document.getElementById("startButton").style.display = "none";
      gameStarted = true;
      initGame();
      requestAnimationFrame(gameLoop);
    }

    function initGame() {
      player.y = 500;
      platforms = [{ x: 50, y: 580, width: 200, height: 20 }];
      for (let i = 1; i < totalPlatforms; i++) {
        const x = i * platformSpacing;
        const y = 500 - Math.random() * 200;
        platforms.push({ x, y, width: 100, height: 20 });
        const coinTypes = ['btc', 'eth', 'coin'];
        coins.push({
          x: x + 25,
          y: y - 30,
          type: coinTypes[i % coinTypes.length],
          collected: false
        });
      }
    }

    function gameLoop() {
      if (!gameStarted || gameEnded) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (keys["ArrowRight"]) player.vx = 5;
      else if (keys["ArrowLeft"]) player.vx = -5;
      else player.vx = 0;

      if (keys["Space"] && player.grounded) {
        player.vy = player.jumpPower;
        player.grounded = false;
      }

      player.vy += player.gravity;
      player.x += player.vx;
      player.y += player.vy;

      player.grounded = false;
      platforms.forEach(p => {
        if (
          player.x < p.x + p.width &&
          player.x + player.width > p.x &&
          player.y + player.height < p.y + 20 &&
          player.y + player.height > p.y - 20
        ) {
          player.y = p.y - player.height;
          player.vy = 0;
          player.grounded = true;
        }
      });

      if (player.y > canvas.height) {
        gameEnded = true;
        ctx.drawImage(images['down'], player.x, 500);
        return;
      }

      if (player.x > platforms[platforms.length - 1].x) {
        gameEnded = true;
        ctx.drawImage(images['happy'], player.x, player.y);
        return;
      }

      ctx.drawImage(images['idle'], player.x, player.y);

      platforms.forEach(p => {
        ctx.drawImage(images['platform'], p.x, p.y);
      });

      coins.forEach(c => {
        if (!c.collected &&
            player.x < c.x + 20 &&
            player.x + player.width > c.x &&
            player.y < c.y + 20 &&
            player.y + player.height > c.y) {
          c.collected = true;
        }
        if (!c.collected) {
          ctx.drawImage(images[c.type], c.x, c.y);
        }
      });

      requestAnimationFrame(gameLoop);
    }

    loadImages({
      idle: "brett_idle.png",
      down: "brett_down.png",
      happy: "brett_happy.png",
      platform: "platform_green.png",
      btc: "btc.png",
      eth: "eth.png",
      coin: "coin.png"
    }, () => {
      console.log("Images loaded");
    });

    window.addEventListener("keydown", e => keys[e.key] = true);
    window.addEventListener("keyup", e => keys[e.key] = false);
  </script>
</body>
</html>
