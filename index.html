<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Littlebrett: Surf & Jump</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { display: block; background: #87CEEB; }
    #restartBtn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px 40px;
      font-size: 24px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      display: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <button id="restartBtn" onclick="startGame()">Restart</button>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const images = {};
    const toLoad = [
      "brett_idle", "brett_jump", "brett_fall", "brett_walk1",
      "brett_down", "brett_happy", "platform_green", "bg",
      "coin", "btc", "eth"
    ];

    let loaded = 0;
    for (const name of toLoad) {
      const img = new Image();
      img.src = `${name}.png`;
      img.onload = () => { loaded++; if (loaded === toLoad.length) startGame(); };
      images[name] = img;
    }

    let player, platforms, collectibles, cameraX, gameOver, gameWin;

    function startGame() {
      document.getElementById("restartBtn").style.display = "none";
      player = {
        x: 100, y: 0, vx: 0, vy: 0,
        width: 50, height: 50,
        grounded: false
      };
      cameraX = 0;
      gameOver = false;
      gameWin = false;

      platforms = [];
      for (let i = 0; i < 50; i++) {
        platforms.push({
          x: 100 + i * 150,
          y: 250 - Math.floor(Math.random() * 100),
          width: 100,
          height: 20
        });
      }
      collectibles = platforms.map(p => ({
        x: p.x + 30,
        y: p.y - 30,
        collected: false
      }));

      loop();
    }

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images.bg, -cameraX, 0, canvas.width * 2, canvas.height);

      // Gravity
      player.vy += 0.8;
      player.grounded = false;

      // Move
      if (keys["ArrowRight"]) player.vx = 5;
      else if (keys["ArrowLeft"]) player.vx = -5;
      else player.vx = 0;

      if (keys[" "] && player.grounded) player.vy = -12;

      player.x += player.vx;
      player.y += player.vy;

      // Platform collision
      for (const p of platforms) {
        if (
          player.x < p.x + p.width &&
          player.x + player.width > p.x &&
          player.y + player.height < p.y + 20 &&
          player.y + player.height > p.y - 10 &&
          player.vy >= 0
        ) {
          player.y = p.y - player.height;
          player.vy = 0;
          player.grounded = true;
        }
      }

      // Camera follows
      cameraX = player.x - 100;

      // Draw platforms
      for (const p of platforms) {
        ctx.drawImage(images.platform_green, p.x - cameraX, p.y);
      }

      // Draw collectibles
      for (const c of collectibles) {
        if (!c.collected &&
          player.x < c.x + 20 &&
          player.x + player.width > c.x &&
          player.y < c.y + 20 &&
          player.y + player.height > c.y) {
          c.collected = true;
        }
        if (!c.collected) ctx.drawImage(images.coin, c.x - cameraX, c.y);
      }

      // Player out of bounds
      if (player.y > canvas.height) {
        gameOver = true;
        ctx.drawImage(images.brett_down, player.x - cameraX, 200);
        endGame(false);
        return;
      }

      // Player wins
      if (player.x > platforms[platforms.length - 1].x + 50) {
        gameWin = true;
        ctx.drawImage(images.brett_happy, player.x - cameraX, player.y);
        endGame(true);
        return;
      }

      // Draw player
      const img = player.grounded ? images.brett_walk1 : (player.vy < 0 ? images.brett_jump : images.brett_fall);
      ctx.drawImage(img, player.x - cameraX, player.y);

      requestAnimationFrame(loop);
    }

    function endGame(won) {
      document.getElementById("restartBtn").style.display = "block";
    }
  </script>
</body>
</html>
