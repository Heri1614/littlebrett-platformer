<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LittleBrett Platformer</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #87ceeb;
      font-family: sans-serif;
    }
    canvas {
      display: block;
    }
    #startButton, #restartButton {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      font-size: 20px;
      cursor: pointer;
      border-radius: 10px;
    }
    #restartButton {
      top: 70px;
      display: none;
    }
  </style>
</head>
<body>
  <button id="startButton">Start Game</button>
  <button id="restartButton">Restart</button>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameStarted = false;
    let gameOver = false;

    const startButton = document.getElementById("startButton");
    const restartButton = document.getElementById("restartButton");

    startButton.onclick = () => {
      gameStarted = true;
      startButton.style.display = "none";
      restartButton.style.display = "none";
      init();
      animate();
    };

    restartButton.onclick = () => {
      gameOver = false;
      restartButton.style.display = "none";
      init();
    };

    const images = {};
    const imageSources = {
      idle: "brett_idle.png",
      walk: "brett_walk1.png",
      jump: "brett_jump.png",
      fall: "brett_fall.png",
      down: "brett_down.png",
      happy: "brett_happy.png",
      platform: "platform_green.png",
      bg: "bg.png",
      btc: "btc.png",
      eth: "eth.png",
      coin: "coin.png"
    };

    let loadedImages = 0;
    const totalImages = Object.keys(imageSources).length;

    for (let key in imageSources) {
      images[key] = new Image();
      images[key].src = imageSources[key];
      images[key].onload = () => {
        loadedImages++;
        if (loadedImages === totalImages && gameStarted) {
          init();
          animate();
        }
      };
    }

    class Player {
      constructor() {
        this.width = 80;
        this.height = 80;
        this.x = 100;
        this.y = canvas.height - 200;
        this.vx = 0;
        this.vy = 0;
        this.gravity = 1.2;
        this.jumpPower = -20;
        this.onGround = false;
        this.img = images.idle;
      }

      update(platforms) {
        this.vy += this.gravity;
        this.x += this.vx;
        this.y += this.vy;

        this.onGround = false;
        for (let p of platforms) {
          if (
            this.y + this.height >= p.y &&
            this.y + this.height <= p.y + 10 &&
            this.x + this.width > p.x &&
            this.x < p.x + p.width
          ) {
            this.vy = 0;
            this.y = p.y - this.height;
            this.onGround = true;
            break;
          }
        }

        if (this.y > canvas.height) {
          this.img = images.down;
          gameOver = true;
          restartButton.style.display = "block";
        } else if (!this.onGround) {
          this.img = images.fall;
        } else if (keys["ArrowLeft"] || keys["ArrowRight"]) {
          this.img = images.walk;
        } else {
          this.img = images.idle;
        }
      }

      draw() {
        ctx.drawImage(this.img, this.x, this.y, this.width, this.height);
      }
    }

    class Platform {
      constructor(x, y, width = 150, height = 30) {
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
      }

      draw() {
        ctx.drawImage(images.platform, this.x, this.y, this.width, this.height);
      }
    }

    let player;
    let platforms = [];
    const keys = {};

    function init() {
      player = new Player();
      platforms = [
        new Platform(100, canvas.height - 120),
        new Platform(300, canvas.height - 220),
        new Platform(500, canvas.height - 300),
        new Platform(700, canvas.height - 380),
        new Platform(900, canvas.height - 460),
        new Platform(1100, canvas.height - 540)
      ];
    }

    window.addEventListener("keydown", (e) => {
      keys[e.key] = true;
      if (e.key === " " && player.onGround) {
        player.vy = player.jumpPower;
        player.img = images.jump;
      }
    });

    window.addEventListener("keyup", (e) => {
      keys[e.key] = false;
    });

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);
      ctx.drawImage(images.btc, 20, 20, 40, 40);
      ctx.drawImage(images.eth, 70, 20, 40, 40);
      ctx.drawImage(images.coin, 120, 20, 40, 40);

      platforms.forEach(p => p.draw());

      if (!gameOver) {
        if (keys["ArrowLeft"]) player.vx = -5;
        else if (keys["ArrowRight"]) player.vx = 5;
        else player.vx = 0;

        player.update(platforms);
        player.draw();
        requestAnimationFrame(animate);
      } else {
        ctx.drawImage(images.down, player.x, player.y, player.width, player.height);
      }

      if (player.x > 1200) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(images.happy, canvas.width / 2 - 150, canvas.height / 2 - 150, 300, 300);
        restartButton.style.display = "block";
        gameOver = true;
      }
    }
  </script>
</body>
</html>
