<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Littlebrett: Surf & Jump</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { display: block; background: #000; }
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Load images
    const images = {};
    const loadImage = (name, src) => {
      return new Promise(resolve => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
          images[name] = img;
          resolve();
        };
      });
    };

    const loadAllImages = async () => {
      await Promise.all([
        loadImage("bg", "img/backgrounds/bg.png"),
        loadImage("brett_idle", "img/player/brett_idle.png"),
        loadImage("brett_jump", "img/player/brett_jump.png"),
        loadImage("platform_green", "img/platforms/platform_green.png"),
        loadImage("platform_red", "img/platforms/platform_red.png"),
        loadImage("coin", "img/collectibles/coin.png"),
      ]);
    };

    class Player {
      constructor() {
        this.x = 100;
        this.y = 300;
        this.width = 64;
        this.height = 64;
        this.vx = 0;
        this.vy = 0;
        this.onGround = false;
      }

      draw() {
        const sprite = this.vy < 0 ? images.brett_jump : images.brett_idle;
        ctx.drawImage(sprite, this.x - camera.x, this.y, this.width, this.height);
      }

      update() {
        this.vy += 1; // gravity
        this.y += this.vy;
        this.x += this.vx;

        // Check collisions
        this.onGround = false;
        platforms.forEach(p => {
          if (
            this.x + this.width > p.x &&
            this.x < p.x + p.width &&
            this.y + this.height > p.y &&
            this.y + this.height < p.y + p.height &&
            this.vy >= 0
          ) {
            if (p.type === "green") {
              this.vy = 0;
              this.y = p.y - this.height;
              this.onGround = true;
            } else if (p.type === "red") {
              gameOver = true;
            }
          }
        });

        // Fall out
        if (this.y > canvas.height + 100) {
          gameOver = true;
        }

        // Move camera
        camera.x = this.x - 150;
      }
    }

    class Platform {
      constructor(x, y, type = "green") {
        this.x = x;
        this.y = y;
        this.width = 100;
        this.height = 20;
        this.type = type;
      }

      draw() {
        const img = this.type === "green" ? images.platform_green : images.platform_red;
        ctx.drawImage(img, this.x - camera.x, this.y, this.width, this.height);
      }
    }

    let player = new Player();
    let camera = { x: 0 };
    let platforms = [];
    let gameOver = false;

    const initPlatforms = () => {
      platforms = [];
      let x = 50;
      let y = 400;

      for (let i = 0; i < 50; i++) {
        let type = i % 7 === 0 ? "red" : "green";
        platforms.push(new Platform(x, y, type));
        x += 150 + Math.random() * 50;
        y = 300 + Math.sin(i * 0.5) * 60;
      }
    };

    const drawBackground = () => {
      ctx.drawImage(images.bg, -camera.x * 0.5, 0, canvas.width * 2, canvas.height);
    };

    const drawGameOver = () => {
      ctx.fillStyle = "white";
      ctx.font = "48px Arial";
      ctx.fillText("Game Over", canvas.width / 2 - 120, canvas.height / 2);
    };

    const gameLoop = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground();

      platforms.forEach(p => p.draw());
      player.update();
      player.draw();

      if (gameOver) {
        drawGameOver();
      } else {
        requestAnimationFrame(gameLoop);
      }
    };

    document.addEventListener("keydown", e => {
      if (e.code === "ArrowRight") player.vx = 4;
      if (e.code === "ArrowLeft") player.vx = -4;
      if (e.code === "Space" && player.onGround) player.vy = -18;
    });

    document.addEventListener("keyup", e => {
      if (e.code === "ArrowRight" || e.code === "ArrowLeft") player.vx = 0;
    });

    const startGame = async () => {
      await loadAllImages();
      initPlatforms();
      gameLoop();
    };

    startGame();
  </script>
</body>
</html>
