<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LittleBrett Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    canvas { display: block; background: url('bg.png') no-repeat center center; background-size: cover; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gravity = 0.8;
    let gameStarted = false;

    const images = {};
    const imageSources = {
      brett_idle: 'brett_idle.png',
      brett_jump: 'brett_jump.png',
      brett_happy: 'brett_happy.png',
      brett_down: 'brett_down.png',
      platform: 'platform_green.png',
      coin: 'coin.png',
      btc: 'btc.png',
      eth: 'eth.png',
      btn_start: 'btn_start.png',
    };

    let keys = {};

    let platforms = [];
    const coins = [];

    const player = {
      x: 100,
      y: 0,
      width: 50,
      height: 50,
      vy: 0,
      vx: 0,
      onGround: false,
      currentImg: 'brett_idle'
    };

    function loadImages(sources, callback) {
      let loaded = 0;
      const total = Object.keys(sources).length;
      for (let key in sources) {
        images[key] = new Image();
        images[key].src = sources[key];
        images[key].onload = () => {
          loaded++;
          if (loaded === total) callback();
        }
      }
    }

    function createPlatforms() {
      platforms = [];
      let x = 50;
      let y = canvas.height - 150;
      for (let i = 0; i < 50; i++) {
        platforms.push({ x, y });
        // Alternar altura para dificultad
        if (i % 2 === 0) y -= 20; else y += 20;
        x += 150;
      }
      player.x = platforms[0].x + 10;
      player.y = platforms[0].y - player.height;
    }

    function createCoins() {
      coins.length = 0;
      for (let i = 0; i < platforms.length; i++) {
        const type = i % 3 === 0 ? 'btc' : (i % 3 === 1 ? 'eth' : 'coin');
        coins.push({
          x: platforms[i].x + 10,
          y: platforms[i].y - 30,
          type,
          collected: false
        });
      }
    }

    function drawButton() {
      ctx.drawImage(images.btn_start, canvas.width / 2 - 100, canvas.height / 2 - 100, 200, 100);
    }

    function drawPlayer() {
      ctx.drawImage(images[player.currentImg], player.x - cameraX, player.y, player.width, player.height);
    }

    function drawPlatforms() {
      platforms.forEach(p => {
        ctx.drawImage(images.platform, p.x - cameraX, p.y, 100, 20);
      });
    }

    function drawCoins() {
      coins.forEach(c => {
        if (!c.collected)
          ctx.drawImage(images[c.type], c.x - cameraX, c.y, 25, 25);
      });
    }

    function updatePlayer() {
      player.vy += gravity;
      player.y += player.vy;

      player.x += player.vx;

      player.onGround = false;
      platforms.forEach(p => {
        if (
          player.x + player.width > p.x &&
          player.x < p.x + 100 &&
          player.y + player.height > p.y &&
          player.y + player.height < p.y + 20 &&
          player.vy >= 0
        ) {
          player.y = p.y - player.height;
          player.vy = 0;
          player.onGround = true;
        }
      });

      // Recoge monedas
      coins.forEach(c => {
        if (!c.collected &&
          player.x + player.width > c.x &&
          player.x < c.x + 25 &&
          player.y + player.height > c.y &&
          player.y < c.y + 25
        ) {
          c.collected = true;
        }
      });

      // Fuera del mapa
      if (player.y > canvas.height) {
        player.currentImg = 'brett_down';
        drawEverything();
        return setTimeout(() => alert("You lost!"), 100);
      }

      // Llega al final
      if (player.x > platforms[platforms.length - 1].x + 50) {
        player.currentImg = 'brett_happy';
        drawEverything();
        return setTimeout(() => alert("You win!"), 100);
      }

      player.currentImg = player.vy < 0 ? 'brett_jump' : 'brett_idle';
    }

    let cameraX = 0;

    function drawEverything() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlatforms();
      drawCoins();
      drawPlayer();
    }

    function gameLoop() {
      if (!gameStarted) {
        drawButton();
        requestAnimationFrame(gameLoop);
        return;
      }

      // Movimiento
      player.vx = 0;
      if (keys['ArrowRight']) player.vx = 5;
      if (keys['ArrowLeft']) player.vx = -5;

      updatePlayer();
      cameraX = player.x - canvas.width / 2 + player.width / 2;

      drawEverything();
      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener('click', function (e) {
      if (!gameStarted) {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        if (
          mx >= canvas.width / 2 - 100 &&
          mx <= canvas.width / 2 + 100 &&
          my >= canvas.height / 2 - 100 &&
          my <= canvas.height / 2
        ) {
          gameStarted = true;
        }
      }
    });

    document.addEventListener('keydown', e => {
      keys[e.key] = true;
      if ((e.key === 'ArrowUp' || e.key === ' ') && player.onGround) {
        player.vy = -15;
      }
    });
    document.addEventListener('keyup', e => keys[e.key] = false);

    loadImages(imageSources, () => {
      createPlatforms();
      createCoins();
      gameLoop();
    });
  </script>
</body>
</html>
