<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Littlebrett: Surf & Jump</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { display: block; background: url('bg.png') no-repeat center center; background-size: cover; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="960" height="540"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const gravity = 0.5;
    const jumpStrength = -12;
    const moveSpeed = 5;

    let cameraX = 0;

    const brett = {
      x: 100,
      y: 300,
      width: 60,
      height: 60,
      dx: 0,
      dy: 0,
      grounded: false,
      img: new Image(),
    };
    brett.img.src = "brett_idle.png";

    const keys = {};
    document.addEventListener("keydown", (e) => keys[e.code] = true);
    document.addEventListener("keyup", (e) => keys[e.code] = false);

    const platforms = [];
    for (let i = 0; i < 50; i++) {
      const height = Math.random() * 150 + 200;
      platforms.push({
        x: i * 200,
        y: height,
        width: 120,
        height: 20,
        isRed: Math.random() < 0.2, // 20% chance sea peligrosa
      });
    }

    const collectibles = platforms.map(p => ({
      x: p.x + p.width / 2 - 10,
      y: p.y - 40,
      width: 20,
      height: 20,
      collected: false,
    }));

    const coinImg = new Image();
    coinImg.src = "coin.png";

    const redPlatform = new Image();
    redPlatform.src = "platform_red.png";

    const greenPlatform = new Image();
    greenPlatform.src = "platform_green.png";

    let gameOver = false;

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.save();
      ctx.translate(-cameraX, 0);

      // Draw platforms
      platforms.forEach(p => {
        const img = p.isRed ? redPlatform : greenPlatform;
        ctx.drawImage(img, p.x, p.y, p.width, p.height);
      });

      // Draw collectibles
      collectibles.forEach(c => {
        if (!c.collected) ctx.drawImage(coinImg, c.x, c.y, c.width, c.height);
      });

      // Draw Brett
      ctx.drawImage(brett.img, brett.x, brett.y, brett.width, brett.height);

      ctx.restore();
    }

    function update() {
      if (gameOver) return;

      brett.dx = 0;
      if (keys["ArrowRight"]) brett.dx = moveSpeed;
      if (keys["ArrowLeft"]) brett.dx = -moveSpeed;

      if (keys["Space"] && brett.grounded) {
        brett.dy = jumpStrength;
        brett.grounded = false;
      }

      brett.dy += gravity;
      brett.x += brett.dx;
      brett.y += brett.dy;

      brett.grounded = false;
      platforms.forEach(p => {
        if (
          brett.x + brett.width > p.x &&
          brett.x < p.x + p.width &&
          brett.y + brett.height > p.y &&
          brett.y + brett.height < p.y + p.height &&
          brett.dy > 0
        ) {
          brett.y = p.y - brett.height;
          brett.dy = 0;
          brett.grounded = true;

          if (p.isRed) gameOver = true;
        }
      });

      if (brett.y > canvas.height) gameOver = true;

      collectibles.forEach(c => {
        if (!c.collected &&
          brett.x + brett.width > c.x &&
          brett.x < c.x + c.width &&
          brett.y + brett.height > c.y &&
          brett.y < c.y + c.height
        ) {
          c.collected = true;
        }
      });

      // Bloquear retroceso
      if (brett.x < cameraX) brett.x = cameraX;

      // Seguir a Brett con la cámara
      cameraX = Math.max(brett.x - 150, 0);

      if (brett.x > 200 * 49 + 150) alert("¡Felicidades! Nivel completado.");
    }

    function loop() {
      update();
      draw();
      if (!gameOver) requestAnimationFrame(loop);
      else alert("Game Over");
    }

    loop();
  </script>
</body>
</html>
