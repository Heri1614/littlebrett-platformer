<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LittleBrett Platformer</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas {
      display: block;
      background: url('img/bg.png') no-repeat center center;
      background-size: cover;
    }
    #startBtn {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      cursor: pointer;
      z-index: 2;
    }
  </style>
</head>
<body>
  <img id="startBtn" src="img/btn_start.png" width="150" alt="Start Game">
  <canvas id="gameCanvas" width="1024" height="576"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');

    let gameStarted = false;

    // Load assets
    const images = {};
    const imageSources = {
      brett: 'img/brett_idle.png',
      brettWalk: 'img/brett_walk1.png',
      brettJump: 'img/brett_jump.png',
      brettFall: 'img/brett_fall.png',
      platformGreen: 'img/platform_green.png',
      platformRed: 'img/platform_red.png',
      btc: 'img/btc.png',
      eth: 'img/eth.png',
      coin: 'img/coin.png'
    };

    let loadedImages = 0;
    const totalImages = Object.keys(imageSources).length;

    function loadImages(callback) {
      for (let key in imageSources) {
        images[key] = new Image();
        images[key].src = imageSources[key];
        images[key].onload = () => {
          loadedImages++;
          if (loadedImages === totalImages) callback();
        };
      }
    }

    // Game objects
    const player = {
      x: 100,
      y: 0,
      width: 50,
      height: 50,
      yVelocity: 0,
      jumpForce: -15,
      grounded: false
    };

    const gravity = 0.8;
    const keys = {};

    const platforms = [
      { x: 0, y: 500, width: 400, type: 'green' },
      { x: 500, y: 400, width: 300, type: 'red' }
    ];

    const coins = [
      { x: 520, y: 350, type: 'btc' },
      { x: 580, y: 350, type: 'eth' },
      { x: 640, y: 350, type: 'coin' }
    ];

    function update() {
      if (!gameStarted) return;

      player.yVelocity += gravity;
      player.y += player.yVelocity;

      if (keys[' ']) {
        if (player.grounded) {
          player.yVelocity = player.jumpForce;
          player.grounded = false;
        }
      }

      player.grounded = false;
      platforms.forEach(p => {
        if (player.x < p.x + p.width &&
            player.x + player.width > p.x &&
            player.y + player.height < p.y + 10 &&
            player.y + player.height + player.yVelocity >= p.y) {
          player.y = p.y - player.height;
          player.yVelocity = 0;
          player.grounded = true;
        }
      });

      draw();
      requestAnimationFrame(update);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw platforms
      platforms.forEach(p => {
        const img = images[p.type === 'green' ? 'platformGreen' : 'platformRed'];
        ctx.drawImage(img, p.x, p.y, p.width, 30);
      });

      // Draw coins
      coins.forEach(c => {
        ctx.drawImage(images[c.type], c.x, c.y, 40, 40);
      });

      // Draw player
      let playerImg = images.brett;
      if (!player.grounded) {
        playerImg = player.yVelocity < 0 ? images.brettJump : images.brettFall;
      } else {
        playerImg = images.brettWalk;
      }
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
    }

    // Key Events
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);

    // Start Game
    startBtn.addEventListener('click', () => {
      startBtn.style.display = 'none';
      gameStarted = true;
      update();
    });

    loadImages(() => console.log('All assets loaded.'));
  </script>
</body>
</html>
