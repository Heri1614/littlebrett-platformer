<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LittleBrett Platformer</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameStarted = false;
    let gameOver = false;

    const images = {};
    const imagePaths = {
      bg: "img/backgrounds/bg.png",
      btn_start: "img/ui/btn_start.png",
      player_idle: "img/player/brett_idle.png",
      player_jump: "img/player/brett_jump.png",
      player_fall: "img/player/brett_fall.png",
      player_walk: "img/player/brett_walk1.png",
      platform_green: "img/platforms/platform_green.png",
      platform_red: "img/platforms/platform_red.png"
    };

    let player = {
      x: 100,
      y: 100,
      width: 60,
      height: 60,
      dy: 0,
      onGround: false,
      img: null
    };

    const GRAVITY = 1;
    const JUMP_FORCE = -18;
    const SCROLL_SPEED = 5;

    let platforms = [];

    function loadImages(paths, callback) {
      let loaded = 0;
      let count = Object.keys(paths).length;
      for (let key in paths) {
        images[key] = new Image();
        images[key].src = paths[key];
        images[key].onload = () => {
          loaded++;
          if (loaded === count) callback();
        };
      }
    }

    function resetGame() {
      player.x = 100;
      player.y = canvas.height - 200;
      player.dy = 0;
      player.onGround = false;
      gameOver = false;
      platforms = [];

      for (let i = 0; i < 20; i++) {
        generatePlatform(i * 200);
      }
    }

    function generatePlatform(x) {
      const y = canvas.height - Math.random() * 200 - 100;
      const type = Math.random() < 0.8 ? "green" : "red";
      platforms.push({
        x,
        y,
        width: 120,
        height: 20,
        type
      });
    }

    function drawBackground(scrollX) {
      ctx.drawImage(images.bg, -scrollX * 0.5, 0, canvas.width * 2, canvas.height);
    }

    function drawPlayer() {
      ctx.drawImage(player.img, player.x - cameraX, player.y, player.width, player.height);
    }

    function drawPlatforms() {
      platforms.forEach(p => {
        const img = p.type === "green" ? images.platform_green : images.platform_red;
        ctx.drawImage(img, p.x - cameraX, p.y, p.width, p.height);
      });
    }

    function checkCollisions() {
      player.onGround = false;
      platforms.forEach(p => {
        if (
          player.x + player.width > p.x &&
          player.x < p.x + p.width &&
          player.y + player.height > p.y &&
          player.y + player.height < p.y + p.height + 20 &&
          player.dy >= 0
        ) {
          if (p.type === "red") {
            gameOver = true;
          } else {
            player.y = p.y - player.height;
            player.dy = 0;
            player.onGround = true;
          }
        }
      });

      if (player.y > canvas.height) {
        gameOver = true;
      }
    }

    function update() {
      if (gameOver) return;

      player.img = player.onGround ? images.player_walk : (player.dy < 0 ? images.player_jump : images.player_fall);

      player.y += player.dy;
      player.dy += GRAVITY;

      if (player.onGround && keys["Space"]) {
        player.dy = JUMP_FORCE;
      }

      player.x += SCROLL_SPEED;
      cameraX = player.x - 150;

      if (platforms[platforms.length - 1].x - cameraX < canvas.width) {
        generatePlatform(platforms[platforms.length - 1].x + 200);
      }

      checkCollisions();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground(cameraX);
      drawPlatforms();
      drawPlayer();

      if (gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.font = "60px Arial";
        ctx.textAlign = "center";
        ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2);
      }
    }

    function loop() {
      requestAnimationFrame(loop);
      if (gameStarted && !gameOver) update();
      draw();
    }

    const keys = {};
    window.addEventListener("keydown", e => keys[e.code] = true);
    window.addEventListener("keyup", e => keys[e.code] = false);

    let cameraX = 0;

    function startScreen() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);
      ctx.drawImage(images.btn_start, canvas.width / 2 - 150, canvas.height / 2 - 50, 300, 100);

      canvas.addEventListener("click", function handleStartClick(e) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        if (
          x > canvas.width / 2 - 150 &&
          x < canvas.width / 2 + 150 &&
          y > canvas.height / 2 - 50 &&
          y < canvas.height / 2 + 50
        ) {
          gameStarted = true;
          resetGame();
          canvas.removeEventListener("click", handleStartClick);
        }
      });
    }

    loadImages(imagePaths, () => {
      player.img = images.player_idle;
      startScreen();
      loop();
    });
  </script>
</body>
</html>
